package utils;

import xxxx.tao.graph.*;

import java.util.HashSet;
import java.util.Set;

public class GraphToCSV {

    private static final String NODES_PATH = "./nodes.csv";
    private static final String RELATIONSHIP_PATH = "./relationship.csv";

    private static Set<String> NODES = new HashSet<>();

    public static void edges2Csv(Edges edges){
        for (Edge edge:
             edges.getAllEdges()) {
            edge2Csv(edge);
        }
    }

    public static void edge2Csv(Edge edge){
        Caller caller = edge.getCaller();
        Callee callee = edge.getCallee();
        relationship2Csv(caller, callee, edge.getCallerType().toString(), edge.getCallerLineNumber());
    }


    public static void callers2Csv(Callers callers){
        for (Caller caller:
             callers.getAllCaller()) {
            caller2Csv(caller
            );
        }
    }


    public static void caller2Csv(Caller caller){
        String signature = caller.getSignature();
        String md5 = Utils.getMD5Str(signature);
        signature2Csv(md5, signature, "node");
    }


    public static void callees2Csv(Callees callees){
        for (Callee callee:
                callees.getAllCallee()) {
            callee2Csv(callee
            );
        }
    }


    public static void callee2Csv(Callee callee){
        String signature = callee.getSignature();
        String md5 = Utils.getMD5Str(signature);
        signature2Csv(md5, signature, "node");

    }


    private static void signature2Csv(String id, String signature, String label){
        if(NODES.contains(signature)) return;
        NODES.add(signature);
        Utils.appendFile(NODES_PATH, String .format("%s#%s#%s\n", id, signature, label));
    }

    private static void relationship2Csv(Caller caller, Callee callee,  String invokeType, int lineNumber){
        String callerID = Utils.getMD5Str(caller.getSignature());
        String calleeID = Utils.getMD5Str(callee.getSignature());
        Utils.appendFile(RELATIONSHIP_PATH, String.format("%s#%s#%s#%d\n", callerID,
                calleeID, invokeType, lineNumber));
    }































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































}
